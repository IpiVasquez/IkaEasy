var nowTabId,_url;function checkForValidUrl(tabId,changeInfo,tab){tab.url.indexOf(".ikariam.gameforge.com")>-1?(chrome.pageAction.show(tabId),nowTabId=tabId,_url=tab.url):window.close()}chrome.tabs.onUpdated.addListener(checkForValidUrl),chrome.extension.onRequest.addListener(function(request,sender,callback){"ajax"==request.type?new _ajax(request.url,request.method,request.vars,callback):callback({})});function _ajax(url,method,vars,callback){method||(method="GET");var xhr=new XMLHttpRequest;xhr.open(method.toUpperCase(),url,!0),xhr.onreadystatechange=function(){xhr.onreadystatechange=function(){4==xhr.readyState&&callback&&callback({response:xhr.responseText})}},xhr.onerror=function(e){},"post"==method.toLowerCase()&&(xhr.setRequestHeader("Accept-Charset","utf-8"),xhr.setRequestHeader("Accept-Language","ru, en"),xhr.setRequestHeader("Connection","close"),xhr.setRequestHeader("Content-length",vars.length),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"));try{xhr.send(vars)}catch(e){}}mr.start(),chrome.storage.sync.get("mn",function(item){"false"==item.mn&&mr.stop()}),chrome.storage.onChanged.addListener(function(changes,namespace){"false"==changes.mn.newValue?(mr.stop(),stopRequest()):mr.start()});function startRequest(){window.setTimeout(startRequest,1e3)}startRequest();